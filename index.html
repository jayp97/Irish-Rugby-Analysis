<html>
<head>
    <meta charset="utf-8">
    <title>Irish Rugby Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="simple_statistics.js"></script>

    <script src="https://d3js.org/d3-color.v2.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v2.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/style.css">

</head>
<body>
    <div class="main-content">
        <h1 class="title"><i>A History of Irish Rugby</i> <br>Count(y)ing the Players </h1>
        <div class="spacer-1"></div>
        <p>Having read <a href="https://nba-origins.herokuapp.com">"Where are NBA Players from?"</a> by Sam Learner, a great interactive map that displays the history of the NBA with respect to its players (you should totally check it out), I was inspired to do a similar thing for Irish Rugby.</p>
        <p>The map to the right plots the home counties of all Irish born Rugby players who have ever existed by place of birth. Use the toggle and buttons below to change the 5-year period and the specific player metrics. Click on the map to see the statistics displayed.</p>
        <div id="sliderContainer">
            <input id="timeslide" type="range" min="0" max="28" value="28" step="1"/><br>
            <span id="range">2015-2020</span>
        </div>
        <div class="button-group-1">
            <button id="player-debut" type="button" value="Player Debut" title="Only include players who debuted in the selected time period">
                Player Debut
             </button>
             <button class="active" id="all-time" type="button" value="All Time" title="Include all players who debuted on or before the selected time period">
                 All Time
             </button>
        </div>
        <!-- <div class="button-group-2">
            <button id="per-capita" type="button" value="Per Capita" >
                Per Capita
             </button>
             <button class="active" id="totals" type="button" value="Totals" >
                 Totals
             </button>
        </div> -->
        <div class="button-group-3">
            <button class="bg3 active" id="players" type="button" value="players" title=" Includes the total number of players who played for each county">
                Players
             </button>
            <button class="bg3" id="matches" type="button" value="matches" title=" Include total number of matches each player has played">
                Caps
             </button>
             <button class= "bg3"  id="Starts" type="button" value="starts" title="Include total number of starts each player has had">
                 Starts
             </button>
             <button class="bg3" id="subs" type="button" value="substitutions" title=" Include total number of matches each player has come on as a substitution">
                Subs
             </button>
             <button class="bg3" id="points" type="button" value="points" title=" Include total number of points each player has scored">
                Points
             </button>
             <button class="bg3" id="tries" type="button" value="tries" title=" Include total number of tries each player has scored">
                Tries
             </button>
             <button class="bg3" id="convs" type="button" value="conversions" title=" Include total number of conversions each player has made">
                Conversions
             </button>
             <button class="bg3" id="pens" type="button" value="penalties" title=" Include total number of pentalties each player has scored">
                Penalties
             </button>
             <button class="bg3" id="drop-goal" type="button" value="drop goals" title=" Include total number of drop goals each player has scored">
                Drop Goals
             </button>
             <button class="bg3" id="won" type="button" value="won" title=" Include total number of games each player has won">
                Won
             </button>
             <button class="bg3" id="lost" type="button" value="lost" title=" Include total number of games each player has lost">
                Lost
             </button>
             <button class="bg3" id="drawn" type="button" value="drawn" title=" Include total number of games each player has drawn">
                Drawn
             </button>
        </div>
        <p class="extra-info" style="font-size: 11px">
           All players are filtered by PLACE OF BIRTH. Therefore some players where born in one county but lived most of their life in another. Take Rory Best as an example. He was born in County Armagh but grew up in County Down. Therefore, his data is bound to County Armagh not Down. <br> <br>
           Some players, such as Ronan O'Gara, where born outside of Ireland and therefore their data is not associated with any county. <br> <br>
           Finally, it was not possible to find place of birth data for several 100 players and therefore they have been excluded from the analysis. 
        </p>
    </div>
    <hr>
    <div class="outro">

        <p>
            Visualisation by <a href="http://www.jaypinion.com">Jay Pinion</a> | <a href="mailto:jaypinion97@gmail.com"><img class="icon-img" src="/images/email.svg"></a> | <a href="https://twitter.com/JayPinion"><img class="icon-img" src="images/twitter.svg"></a> | <a href="https://github.com/jayp97"><img class="icon-img" src="images/github.png"></a> | <a href="https://www.instagram.com/jaypinion/"><img class="icon-img" src="images/instagram.svg"></a>
            <br class="mini"><br class="mini">
            Code and data for this project lives <a href="https://github.com/jayp97/Irish-Rugby-Analysis">here</a>. 
            <br class="mini"><br class="mini">
            All Irish Rugby player data scraped from this <a href="http://en.espn.co.uk/scrum/rugby/player/caps.html?team=3"> ESPN Database</a>. The data used was data corresponding to all games before the 24th Novemeber 2020.
            <br class="mini"><br class="mini">
            <b>HTML</b>, <b>CSS</b>, <b>Javascript</b>, and <b>Python</b> were all used to create this interactive map. The <b>D3.js</b> Javascript library was used extensively for the data visualisation and mapping functionality. 
            The python library <b>Beautiful Soup</b> was used to scrape the data from the ESPN website. 
            Ireland counties GeoJson from <a href="https://www.townlands.ie/page/download/">townlands.ie</a>, simplified to TopoJSON using <a href="https://mapshaper.org/">mapshaper</a>.
            <br class="mini"><br class="mini">
            Last Updated: December 2020
        </p>
       
    </div>
    <div id="myItemList">
        <h2 id="item-list-county"></h2>
        <h3 id="item-list-metric"></h3>
        <div id="metric-list"></div>
    </div>
        <!-- <h2 class="name"></h2>
        <h2 class="total-players"></h2>
        <div class="tool-tip"></div> -->
  <script>
        
    // var width = window.innerWidth,
    //     height = window.innerHeight;
    // rangeValue = null;
    rangeValue = [2015,2020]; 
    period = [[1875,1880], [1880,1885],[1885,1890], [1890,1895], [1895,1900], [1900,1905], [1905,1910], [1910,1915], [1915,1920], [1920,1925], [1925,1930], [1930,1935], [1935,1940], [1940,1945], [1945,1950], [1950,1955], [1955,1960], [1960,1965], [1965,1970], [1970,1975], [1975,1980], [1980,1985], [1985,1990], [1990,1995], [1995,2000], [2000,2005], [2005,2010], [2010,2015], [2015,2020]] ;

    buttonSetOne = "All Time"
    buttonSetThree = "players"

    var width = 650,
        height = 810;
    
    var svg = d3.select( "body" )
          .append( "svg" )
          .attr( "width", width )
          .attr( "height", height );
      
    var projection = d3.geo.albers()
        .center([0, 53.4])
        .rotate([8.1, 0])
        .parallels([50, 60])
        .scale(11000)
        .translate([width / 2, height / 2]);

    var geoPath = d3.geo.path()
        .projection(projection);


        // d3.csv("irish-counties-population.csv", function(data) {
    data = d3.json("final-data/irish-player-data.json", function(data) {
        // console.log(data[0][1000]["birth_place"]["county"]);

        queue()
            .defer(d3.json, "counties-topo.json")
            .await(ready);

            function ready(error, counties) {

                let breaks = ss.jenks(counties.objects.counties.geometries.map(function(d) {
                                return playerCount(d.properties.NAME_TAG, rangeValue)/1;
                            }), 9);

                breaks.shift(); // remove min value from breaks Array before applying to domain
                breaks.pop(); // same for max

                let colors = d3.schemeYlGn[9];

                let jenks = d3.scale.pow()
                    .domain(breaks)
                    .range(colors);
                
                // let jenks = d3.scale.threshold()
                //     .domain(breaks)
                //     .range(colors);

                //////??????????? SHOULD THE GLOBAL VARIABLE FOR BUTTONSETONE CHANGE BEFORE THIS TO PLAYER DEBUT???
                let breakers = ss.jenks(counties.objects.counties.geometries.map(function(d) {
                    return playerCount(d.properties.NAME_TAG, rangeValue)/1;
                }),5);

                // breakers.shift(); // remove min value from breaks Array before applying to domain
                // breakers.pop(); // same for max
                
                cols = d3.schemeYlGn[5];

                let jenkers = d3.scale.pow()
                    .domain(breakers)
                    .range(cols);
                

            function playerCount(county, range) {
                let infoBox = []
                let counter = 0
                var dataCount = Object.keys(data[0]).length
                for (var i = 1; i < dataCount+1; i++) {

                    if (buttonSetOne == "Player Debut") {
                        if (county == data[0][i]["birth_place"]["county"] && data[0][i]["debut year"] > range[0] && data[0][i]["debut year"] <= range[1]) {
                            if (buttonSetThree == "players") {
                                counter++; 
                            }
                            else {
                                counter = counter + parseInt(data[0][i]["statistics"][buttonSetThree]); 
                                infoBox.push([data[0][i]["name"], parseInt(data[0][i]["statistics"][buttonSetThree])]);
                            }
                        }
                        if (range[0]==1875 && county == data[0][i]["birth_place"]["county"] && data[0][i]["debut year"]==1875) {
                            if (buttonSetThree == "players") {
                                counter++;  
                            }
                            else {
                                counter = counter + parseInt(data[0][i]["statistics"][buttonSetThree]); 
                                infoBox.push([data[0][i]["name"], parseInt(data[0][i]["statistics"][buttonSetThree])]); 
                            }
                        }       
                    }
                    else if (buttonSetOne == "All Time") {
                        if (county == data[0][i]["birth_place"]["county"] && data[0][i]["debut year"] >= period[0][0] && data[0][i]["debut year"] <= range[1]) {
                            if (buttonSetThree == "players") {
                                counter++;
                            }  
                            else {
                                counter = counter + parseInt(data[0][i]["statistics"][buttonSetThree]); 
                                infoBox.push([data[0][i]["name"], parseInt(data[0][i]["statistics"][buttonSetThree])]); 
                            }
                        }
                    }
                    
                }

                sortedInfoBox = infoBox.sort(function(a, b) {
                        return b[1] - a[1];
                    });
                sortedInfoBoxFiltered = sortedInfoBox.filter( info => info[1] != 0);
                // console.log(counter)
                // return counter;
                return +Math.log2(counter+1);
            }


            svg.append("g")
                .selectAll("path")
                .data(topojson.feature(counties, counties.objects.counties).features)
                .enter()
                .append("path")
                .attr("d", geoPath)
                .attr("class", "county")
                .attr("fill", function(d) {
                    console.log(playerCount(d.properties.NAME_TAG, rangeValue)/1)
                    return jenks(playerCount(d.properties.NAME_TAG, rangeValue)/1);
                })
                .on("click", function(d) {
                    document.getElementById('metric-list').innerHTML = "";
                    document.getElementById('item-list-metric').innerHTML = "";
                    document.getElementById('item-list-county').innerHTML = "";

                    document.getElementById('item-list-metric').innerHTML = buttonSetOne +":   " +buttonSetThree;

                    console.log(d.properties.NAME_TAG)
                    document.getElementById('item-list-county').innerHTML = d.properties.NAME_TAG;

                    let items = sortedInfoBoxFiltered;

                    ol = document.createElement('ol');
                    document.getElementById('metric-list').appendChild(ol);

                    items.forEach(function (item) {
                        let li = document.createElement('li');
                        ol.appendChild(li);

                        li.innerHTML += item[0] + " = " + item[1];
                    });
                })
                .on("mouseover", function(d) {
                    d3.select(this).attr("class", "county hover");
                    toolTip.style("visibility", "visible").text(d.properties.NAME_TAG);
                })
                .on("mousemove", d => toolTip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px").text(d.properties.NAME_TAG + ": " +buttonSetThree + " = " + Math.round(Math.pow(2, playerCount(d.properties.NAME_TAG, rangeValue)) - 1)))
                .on("mouseout", function(d) {
                    // d3.select("body").selectAll("h2").text("");
                    d3.select(this).attr("class", "county");
                    toolTip.style("visibility", "hidden");
                });
       



            d3.select("#timeslide").on("input", function() {
            update(+this.value);
            });

            // update the fill of each SVG of class "incident" with value
            function update(value) {
                document.getElementById("range").innerHTML= period[value][0] + " - " + period[value][1];
                rangeValue = period[value];
                console.log(rangeValue)
                d3.selectAll(".county")
                    .attr("fill", function(d) {
                            // return jenks(whatCounty(d.properties.NAME_TAG)/1);
                            // console.log(playerCount(d.properties.NAME_TAG, rangeValue)/1)
                            if (buttonSetOne == "All Time")
                                return jenks(playerCount(d.properties.NAME_TAG, rangeValue)/1);
                            else if (buttonSetOne == "Player Debut")
                                return  jenkers(playerCount(d.properties.NAME_TAG, rangeValue)/1);

                        });
            }

            d3.select("#player-debut").on("click", function() { 
                buttonOneUpdate(this.value);
                // console.log("divisions "+divisions)
                // console.log(buttonSetOne);
                d3.select(this).attr("class", "active");
                d3.select("#all-time").attr("class", "");

            })
            

            d3.select("#all-time").on("click", function() {
                buttonOneUpdate(this.value);
                // console.log("divisions "+divisions)
                // console.log(buttonSetOne);
                d3.select(this).attr("class", "active");
                d3.select("#player-debut").attr("class", "");
            })
            


            function buttonOneUpdate(value){
                buttonSetOne = value;
                d3.selectAll(".county")
                    .attr("fill", function(d) {
                            if (buttonSetOne == "All Time")
                                return jenks(playerCount(d.properties.NAME_TAG, rangeValue)/1);
                            else if (buttonSetOne == "Player Debut")
                                return  jenkers(playerCount(d.properties.NAME_TAG, rangeValue)/1);
                        });
            }


            d3.selectAll(".bg3").on("click", function() {
                buttonThreeUpdate(this.value);
                d3.selectAll(".bg3").attr("class", "bg3");
                d3.select(this).attr("class", "bg3 active");
                
            })

            function buttonThreeUpdate(value){
                buttonSetThree = value;
                d3.selectAll(".county")
                    .attr("fill", function(d) {
                            if (buttonSetOne == "All Time")
                                return jenks(playerCount(d.properties.NAME_TAG, rangeValue)/1);
                            else if (buttonSetOne == "Player Debut")
                                return  jenkers(playerCount(d.properties.NAME_TAG, rangeValue)/1);
                        });
            }


            toolTip = d3.select("body")
                .append("div")
                .style("position", "absolute")
                .style("font-family", "Spectral")
                .style("font-size", "15px")
                .style("background", "white")
                .style("padding", "5px")
                .style("z-index", "10")
                .style("opacity",0.9)
                .style("visibility", "hidden");

        }
    });
 
  </script>
</body>
</html>

