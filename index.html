<html>
<head>
    <meta charset="utf-8">
    <title>How has Ireland Changed? A data driven Visual Essay</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="simple_statistics.js"></script>

    <script src="https://d3js.org/d3-color.v2.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v2.min.js"></script>
    
    <link rel="stylesheet" href="/styles/style.css">

</head>
<body>
    <div class="main-content">
        <h1 class="title"><i>A History of Irish Rugby</i> <br>Count(y)ing the Players </h1>
        <div class="spacer-1"></div>
        <p>Having read <a href="https://nba-origins.herokuapp.com">"Where are NBA Players from?"</a> by Sam Learner, a great interactive map that displays the history of the NBA with respect to its players (you should totally check it out), I was inspired to do a similar thing for Irish Rugby.</p>
        <p>The map to the right plots the home counties of all Irish Rugby players who have ever existed by place of birth. Use the toggle and buttons below to change the 5-year period and the specific player metrics.</p>
        <div id="sliderContainer">
            <input id="timeslide" type="range" min="0" max="28" value="0" step="1"/><br>
            <span id="range">1875-1880</span>
        </div>
    </div>
        <h2 class="name"></h2>
        <h2 class="total-players"></h2>
  <script>
        
    // var width = window.innerWidth,
    //     height = window.innerHeight;
    let inputValue = null;
    let  period = [[1875,1880], [1880,1885],[1885,1890], [1890,1895], [1895,1900], [1900,1905], [1905,1910], [1910,1915], [1915,1920], [1920,1925], [1925,1930], [1930,1935], [1935,1940], [1940,1945], [1945,1950], [1950,1955], [1955,1960], [1960,1965], [1965,1970], [1970,1975], [1975,1980], [1980,1985], [1985,1990], [1990,1995], [1995,2000], [2000,2005], [2005,2010], [2010,2015], [2015,2020]] ;

    var width = 650,
        height = 810;
    
    var svg = d3.select( "body" )
          .append( "svg" )
          .attr( "width", width )
          .attr( "height", height );
      
    var projection = d3.geo.albers()
        .center([0, 53.4])
        .rotate([8.1, 0])
        .parallels([50, 60])
        .scale(11000)
        .translate([width / 2, height / 2]);

    var geoPath = d3.geo.path()
        .projection(projection);


        // d3.csv("irish-counties-population.csv", function(data) {
    d3.csv("data/total-players-per-county.csv", function(data) {
        console.log(typeof data[1].COUNTY);

        function whatCounty(county) {
            // console.log(county)
            let pos; // Object position

            for (var i = 0; i < data.length; i++) {
                if (data[i].COUNTY == county)
                    pos = i;
            }
            return data[pos].TOTAL;
        }

        queue()
            .defer(d3.json, "counties-topo.json")
            .await(ready);

        function ready(error, counties) {

            var breaks = ss.jenks(counties.objects.counties.geometries.map(function(d) {
                // return whatPopulation(d.properties.NAME_TAG) / d.properties.AREA; 
                return whatCounty(d.properties.NAME_TAG)/1;
            }), 9);

            breaks.shift(); // remove min value from breaks Array before applying to domain
            breaks.pop(); // same for max

            var colors = d3.schemeYlGn[9];

            var jenks = d3.scale.threshold()
                .domain(breaks)
                .range(colors);


            svg.append("g")
                .selectAll("path")
                .data(topojson.feature(counties, counties.objects.counties).features)
                .enter()
                .append("path")
                .attr("d", geoPath)
                .attr("class", "county")
                .attr("fill", function(d) {
                    return jenks(whatCounty(d.properties.NAME_TAG)/1);
                })
                .on("mouseover", function(d) {
                    d3.select("body").select(".name").text('County: ' + d.properties.NAME_TAG);
                    d3.select("body").select(".total-players").text("Total Players: " + whatCounty(d.properties.NAME_TAG));
                    d3.select(this).attr("class", "county hover");
                })
                .on("mouseout", function(d) {
                    d3.select("body").selectAll("h2").text("");
                    d3.select(this).attr("class", "county");
                });
        }
    });

    d3.select("#timeslide").on("input", function() {
    update(+this.value);
    });

    // update the fill of each SVG of class "incident" with value
    function update(value) {
        document.getElementById("range").innerHTML=   period[value][0] + " - " + period[value][1];
        inputValue = period[value][0];
        // d3.selectAll(".incident")
        //     .attr("fill", dateMatch);
        }

  </script>
</body>
</html>

